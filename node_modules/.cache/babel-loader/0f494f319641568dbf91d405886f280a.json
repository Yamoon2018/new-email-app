{"ast":null,"code":"var _classCallCheck = require(\"/home/yamin/My_repos/new-email-app/new-email-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/yamin/My_repos/new-email-app/new-email-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar tsscmp = require('tsscmp');\n\nvar crypto = require('crypto');\n\nvar Attachment = require('./attachment');\n\nvar Request = require('./request');\n\nvar builder = require('./build');\n\nvar resources = require('./schema').definitions;\n\nvar mailgunExpirey = 15 * 60 * 1000;\nvar mailgunHashType = 'sha256';\nvar mailgunSignatureEncoding = 'hex';\n\nvar Mailgun = /*#__PURE__*/function () {\n  \"use strict\";\n\n  function Mailgun(options) {\n    _classCallCheck(this, Mailgun);\n\n    if (!options.apiKey) {\n      throw new Error('apiKey value must be defined!');\n    }\n\n    this.username = 'api';\n    this.apiKey = options.apiKey;\n    this.publicApiKey = options.publicApiKey;\n    this.domain = options.domain;\n    this.auth = [this.username, this.apiKey].join(':');\n    this.mute = options.mute || false;\n    this.timeout = options.timeout;\n    this.host = options.host || 'api.mailgun.net';\n    this.endpoint = options.endpoint || '/v3';\n    this.protocol = options.protocol || 'https:';\n    this.port = options.port || 443;\n    this.retry = options.retry || 1;\n    this.testMode = options.testMode;\n    this.testModeLogger = options.testModeLogger;\n\n    if (options.proxy) {\n      this.proxy = options.proxy;\n    }\n\n    this.options = {\n      host: this.host,\n      endpoint: this.endpoint,\n      protocol: this.protocol,\n      port: this.port,\n      auth: this.auth,\n      proxy: this.proxy,\n      timeout: this.timeout,\n      retry: this.retry,\n      testMode: this.testMode,\n      testModeLogger: this.testModeLogger\n    };\n    this.mailgunTokens = {};\n  }\n\n  _createClass(Mailgun, [{\n    key: \"getDomain\",\n    value: function getDomain(method, resource) {\n      var d = this.domain; // filter out API calls that do not require a domain specified\n\n      if (resource.indexOf('/routes') >= 0 || resource.indexOf('/lists') >= 0 || resource.indexOf('/address') >= 0 || resource.indexOf('/domains') >= 0) {\n        d = '';\n      } else if (resource.indexOf('/messages') >= 0 && (method === 'GET' || method === 'DELETE')) {\n        d = \"domains/\".concat(this.domain);\n      }\n\n      return d;\n    }\n  }, {\n    key: \"getRequestOptions\",\n    value: function getRequestOptions(resource) {\n      var o = this.options; // use public API key if we have it for the routes that require it\n\n      if ((resource.indexOf('/address/validate') >= 0 || resource.indexOf('/address/parse') >= 0) && this.publicApiKey) {\n        var copy = Object.assign({}, this.options);\n        copy.auth = [this.username, this.publicApiKey].join(':');\n        o = copy;\n      }\n\n      return o;\n    }\n  }, {\n    key: \"request\",\n    value: function request(method, resource, data, fn) {\n      var fullpath = resource;\n      var domain = this.getDomain(method, resource);\n\n      if (domain) {\n        fullpath = '/'.concat(domain, resource);\n      }\n\n      var req = new Request(this.options);\n      return req.request(method, fullpath, data, fn);\n    }\n  }, {\n    key: \"post\",\n    value: function post(path, data, fn) {\n      var req = new Request(this.options);\n      return req.request('POST', path, data, fn);\n    }\n  }, {\n    key: \"get\",\n    value: function get(path, data, fn) {\n      var req = new Request(this.options);\n      return req.request('GET', path, data, fn);\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(path, data, fn) {\n      var req = new Request(this.options);\n      return req.request('DELETE', path, data, fn);\n    }\n  }, {\n    key: \"put\",\n    value: function put(path, data, fn) {\n      var req = new Request(this.options);\n      return req.request('PUT', path, data, fn);\n    }\n  }, {\n    key: \"validateWebhook\",\n    value: function validateWebhook(timestamp, token, signature) {\n      var _this = this;\n\n      var adjustedTimestamp = parseInt(timestamp, 10) * 1000;\n      var fresh = Math.abs(Date.now() - adjustedTimestamp) < mailgunExpirey;\n\n      if (!fresh) {\n        if (!this.mute) {\n          console.error('[mailgun] Stale Timestamp: this may be an attack');\n          console.error('[mailgun] However, this is most likely your fault\\n');\n          console.error('[mailgun] run `ntpdate ntp.ubuntu.com` and check your system clock\\n');\n          console.error(\"[mailgun] System Time: \".concat(new Date().toString()));\n          console.error(\"[mailgun] Mailgun Time: \".concat(new Date(adjustedTimestamp).toString()), timestamp);\n          console.error(\"[mailgun] Delta: \".concat(Date.now() - adjustedTimestamp));\n        }\n\n        return false;\n      }\n\n      if (this.mailgunTokens[token]) {\n        if (!this.mute) {\n          console.error('[mailgun] Replay Attack');\n        }\n\n        return false;\n      }\n\n      this.mailgunTokens[token] = true;\n      var tokenTimeout = setTimeout(function () {\n        delete _this.mailgunTokens[token];\n      }, mailgunExpirey + 5 * 1000);\n      tokenTimeout.unref();\n      return tsscmp(signature, crypto.createHmac(mailgunHashType, this.apiKey).update(Buffer.from(timestamp + token, 'utf-8')).digest(mailgunSignatureEncoding));\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(address, isPrivate, opts, fn) {\n      if (typeof opts === 'function') {\n        fn = opts;\n        opts = {};\n      }\n\n      if (typeof isPrivate === 'object') {\n        opts = isPrivate;\n        isPrivate = false;\n      }\n\n      if (typeof isPrivate === 'function') {\n        fn = isPrivate;\n        isPrivate = false;\n        opts = {};\n      }\n\n      var resource = '/address/validate';\n\n      if (isPrivate) {\n        resource = '/address/private/validate';\n      }\n\n      var options = this.getRequestOptions(resource);\n      var req = new Request(options);\n      var data = Object.assign({}, {\n        address: address\n      }, opts);\n      return req.request('GET', resource, data, fn);\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(addresses, isPrivate, opts, fn) {\n      if (typeof opts === 'function') {\n        fn = opts;\n        opts = {};\n      }\n\n      if (typeof isPrivate === 'object') {\n        opts = isPrivate;\n        isPrivate = false;\n      }\n\n      if (typeof isPrivate === 'function') {\n        fn = isPrivate;\n        isPrivate = false;\n        opts = {};\n      }\n\n      var resource = '/address/parse';\n\n      if (isPrivate) {\n        resource = '/address/private/parse';\n      }\n\n      var options = this.getRequestOptions(resource);\n      var req = new Request(options);\n      var data = Object.assign({}, {\n        addresses: addresses\n      }, opts);\n      return req.request('GET', resource, data, fn);\n    }\n  }]);\n\n  return Mailgun;\n}();\n\nbuilder.build(Mailgun, resources);\nMailgun.prototype.Attachment = Attachment;\nMailgun.prototype.Mailgun = Mailgun;\n\nfunction create(options) {\n  return new Mailgun(options);\n}\n\nmodule.exports = create;","map":{"version":3,"sources":["/home/yamin/My_repos/new-email-app/new-email-app/node_modules/mailgun-js/lib/mailgun.js"],"names":["tsscmp","require","crypto","Attachment","Request","builder","resources","definitions","mailgunExpirey","mailgunHashType","mailgunSignatureEncoding","Mailgun","options","apiKey","Error","username","publicApiKey","domain","auth","join","mute","timeout","host","endpoint","protocol","port","retry","testMode","testModeLogger","proxy","mailgunTokens","method","resource","d","indexOf","o","copy","Object","assign","data","fn","fullpath","getDomain","concat","req","request","path","timestamp","token","signature","adjustedTimestamp","parseInt","fresh","Math","abs","Date","now","console","error","toString","tokenTimeout","setTimeout","unref","createHmac","update","Buffer","from","digest","address","isPrivate","opts","getRequestOptions","addresses","build","prototype","create","module","exports"],"mappings":"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","sourcesContent":["const tsscmp = require('tsscmp')\nconst crypto = require('crypto')\n\nconst Attachment = require('./attachment')\nconst Request = require('./request')\nconst builder = require('./build')\nconst resources = require('./schema').definitions\n\nconst mailgunExpirey = 15 * 60 * 1000\nconst mailgunHashType = 'sha256'\nconst mailgunSignatureEncoding = 'hex'\n\nclass Mailgun {\n  constructor (options) {\n    if (!options.apiKey) {\n      throw new Error('apiKey value must be defined!')\n    }\n    this.username = 'api'\n    this.apiKey = options.apiKey\n    this.publicApiKey = options.publicApiKey\n    this.domain = options.domain\n    this.auth = [this.username, this.apiKey].join(':')\n    this.mute = options.mute || false\n    this.timeout = options.timeout\n\n    this.host = options.host || 'api.mailgun.net'\n    this.endpoint = options.endpoint || '/v3'\n    this.protocol = options.protocol || 'https:'\n    this.port = options.port || 443\n    this.retry = options.retry || 1\n\n    this.testMode = options.testMode\n    this.testModeLogger = options.testModeLogger\n\n    if (options.proxy) {\n      this.proxy = options.proxy\n    }\n\n    this.options = {\n      host: this.host,\n      endpoint: this.endpoint,\n      protocol: this.protocol,\n      port: this.port,\n      auth: this.auth,\n      proxy: this.proxy,\n      timeout: this.timeout,\n      retry: this.retry,\n      testMode: this.testMode,\n      testModeLogger: this.testModeLogger\n    }\n\n    this.mailgunTokens = {}\n  }\n\n  getDomain (method, resource) {\n    let d = this.domain\n\n    // filter out API calls that do not require a domain specified\n    if ((resource.indexOf('/routes') >= 0) ||\n      (resource.indexOf('/lists') >= 0) ||\n      (resource.indexOf('/address') >= 0) ||\n      (resource.indexOf('/domains') >= 0)) {\n      d = ''\n    } else if ((resource.indexOf('/messages') >= 0) &&\n      (method === 'GET' || method === 'DELETE')) {\n      d = `domains/${this.domain}`\n    }\n\n    return d\n  }\n\n  getRequestOptions (resource) {\n    let o = this.options\n\n    // use public API key if we have it for the routes that require it\n    if ((resource.indexOf('/address/validate') >= 0 ||\n        (resource.indexOf('/address/parse') >= 0)) &&\n      this.publicApiKey) {\n      const copy = Object.assign({}, this.options)\n\n      copy.auth = [this.username, this.publicApiKey].join(':')\n      o = copy\n    }\n\n    return o\n  }\n\n  request (method, resource, data, fn) {\n    let fullpath = resource\n    const domain = this.getDomain(method, resource)\n\n    if (domain) {\n      fullpath = '/'.concat(domain, resource)\n    }\n\n    const req = new Request(this.options)\n\n    return req.request(method, fullpath, data, fn)\n  }\n\n  post (path, data, fn) {\n    const req = new Request(this.options)\n\n    return req.request('POST', path, data, fn)\n  }\n\n  get (path, data, fn) {\n    const req = new Request(this.options)\n\n    return req.request('GET', path, data, fn)\n  }\n\n  delete (path, data, fn) {\n    const req = new Request(this.options)\n\n    return req.request('DELETE', path, data, fn)\n  }\n\n  put (path, data, fn) {\n    const req = new Request(this.options)\n\n    return req.request('PUT', path, data, fn)\n  }\n\n  validateWebhook (timestamp, token, signature) {\n    const adjustedTimestamp = parseInt(timestamp, 10) * 1000\n    const fresh = (Math.abs(Date.now() - adjustedTimestamp) < mailgunExpirey)\n\n    if (!fresh) {\n      if (!this.mute) {\n        console.error('[mailgun] Stale Timestamp: this may be an attack')\n        console.error('[mailgun] However, this is most likely your fault\\n')\n        console.error('[mailgun] run `ntpdate ntp.ubuntu.com` and check your system clock\\n')\n        console.error(`[mailgun] System Time: ${new Date().toString()}`)\n        console.error(`[mailgun] Mailgun Time: ${new Date(adjustedTimestamp).toString()}`, timestamp)\n        console.error(`[mailgun] Delta: ${Date.now() - adjustedTimestamp}`)\n      }\n\n      return false\n    }\n\n    if (this.mailgunTokens[token]) {\n      if (!this.mute) {\n        console.error('[mailgun] Replay Attack')\n      }\n\n      return false\n    }\n\n    this.mailgunTokens[token] = true\n\n    const tokenTimeout = setTimeout(() => {\n      delete this.mailgunTokens[token]\n    }, mailgunExpirey + (5 * 1000))\n\n    tokenTimeout.unref()\n\n    return tsscmp(\n      signature, crypto.createHmac(mailgunHashType, this.apiKey)\n        .update(Buffer.from(timestamp + token, 'utf-8'))\n        .digest(mailgunSignatureEncoding)\n    )\n  }\n\n  validate (address, isPrivate, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    if (typeof isPrivate === 'object') {\n      opts = isPrivate\n      isPrivate = false\n    }\n\n    if (typeof isPrivate === 'function') {\n      fn = isPrivate\n      isPrivate = false\n      opts = {}\n    }\n\n    let resource = '/address/validate'\n\n    if (isPrivate) {\n      resource = '/address/private/validate'\n    }\n\n    const options = this.getRequestOptions(resource)\n\n    const req = new Request(options)\n    const data = Object.assign({}, {\n      address\n    }, opts)\n\n    return req.request('GET', resource, data, fn)\n  }\n\n  parse (addresses, isPrivate, opts, fn) {\n    if (typeof opts === 'function') {\n      fn = opts\n      opts = {}\n    }\n\n    if (typeof isPrivate === 'object') {\n      opts = isPrivate\n      isPrivate = false\n    }\n\n    if (typeof isPrivate === 'function') {\n      fn = isPrivate\n      isPrivate = false\n      opts = {}\n    }\n\n    let resource = '/address/parse'\n\n    if (isPrivate) {\n      resource = '/address/private/parse'\n    }\n\n    const options = this.getRequestOptions(resource)\n\n    const req = new Request(options)\n    const data = Object.assign({}, {\n      addresses\n    }, opts)\n\n    return req.request('GET', resource, data, fn)\n  }\n}\n\nbuilder.build(Mailgun, resources)\n\nMailgun.prototype.Attachment = Attachment\n\nMailgun.prototype.Mailgun = Mailgun\n\nfunction create (options) {\n  return new Mailgun(options)\n}\n\nmodule.exports = create\n"]},"metadata":{},"sourceType":"script"}